<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Inventory - StockedUp</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}" />
    <style> .notes-column { max-width: 200px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; } </style>
</head>
<body class="inventory-page">
    <div class="container">
        <aside class="sidebar">
            <div class="user-info">
                 <h2>Hello,<br />{{ session.username if session.username else 'User' }}</h2>
            </div>
             <!-- This page is active -->
            <a href="{{ url_for('view_inventory') }}"><button class="active">View Inventory</button></a>
            <a href="{{ url_for('add_item_form') }}"><button>Add Item</button></a>
            <a href="{{ url_for('view_inventory') }}"><button title="Select 'Edit' or 'View' in table below">Edit Item</button></a>
            <a href="{{ url_for('search_items_form') }}"><button>Search Item</button></a>
            <!-- *** ADDED Manage Links *** -->
            <a href="{{ url_for('manage_categories') }}"><button>Manage Categories</button></a>
            <a href="{{ url_for('manage_locations') }}"><button>Manage Locations</button></a>
            <!-- ************************** -->
            <a href="{{ url_for('logout_action') }}"><button class="signout">Sign Out</button></a>
        </aside>

        <main class="main-content">
            {% with messages = get_flashed_messages(with_categories=true) %}
              {% if messages %}<div class="flashes">{% for category, message in messages %}
                 <div style="padding: 10px; margin-bottom: 10px; border: 1px solid; border-radius: 4px; color: #000; background-color: {% if category == 'danger' %}#f8d7da{% elif category == 'success' %}#d4edda{% else %}#cfe2ff{% endif %}; border-color: {% if category == 'danger' %}#f5c6cb{% elif category == 'success' %}#c3e6cb{% else %}#b6d4fe{% endif %};">{{ message }}</div>
              {% endfor %}</div>{% endif %}
            {% endwith %}

            <header class="header"><h1>Inventory</h1></header>

            <div class="content-box">
                <div class="search-box">
                     <form method="GET" action="{{ url_for('view_inventory') }}">
                        <input type="text" name="search_term" placeholder="Search Name/Notes..." value="{{ request.args.get('search_term', '') }}">
                        <button type="submit">Search</button>
                        {% if request.args.get('search_term') or request.args.get('category_filter') or request.args.get('location_filter') %}
                          <a href="{{ url_for('view_inventory') }}" style="margin-left:10px;">Clear Search/Filters</a>
                        {% endif %}
                     </form>
                </div>
                <section class="inventory-table">
                    <table>
                        <thead>
                            <tr>
                                <th>Item Name</th> <th>Category</th> <th>Location</th> <th>Quantity</th>
                                <th>Expiration Date</th> <th>Purchase Date</th> <th>Notes</th> <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for item in items %}
                            <tr>
                                <td>{{ item.ItemName }}</td>
                                <td>{{ item.CategoryName if item.CategoryName else 'N/A' }}</td>
                                <td>{{ item.LocationName if item.LocationName else 'N/A' }}</td>
                                <td>{{ item.Quantity }}</td>
                                <td>{{ item.ExpirationDate if item.ExpirationDate else '' }}</td>
                                <td>{{ item.PurchaseDate if item.PurchaseDate else '' }}</td>
                                <td class="notes-column" title="{{ item.Notes if item.Notes else '' }}">{{ item.Notes if item.Notes else '' }}</td>
                                <td>
                                    <a href="{{ url_for('view_item_details', item_id=item.ItemID) }}">View</a> |
                                    <a href="{{ url_for('edit_item_form', item_id=item.ItemID) }}">Edit</a> |
                                    <form method="POST" action="{{ url_for('delete_item_action', item_id=item.ItemID) }}" style="display:inline;" onsubmit="return confirm('Are you sure you want to delete {{ item.ItemName | escape }}?');">
                                        <button type="submit" style="background:none; border:none; font-size: 1rem; padding:0; color: #dc3545; text-decoration:underline; cursor:pointer;">Delete</button>
                                    </form>
                                </td>
                            </tr>
                            {% else %}
                              <tr> <td colspan="8" style="text-align: center;">No items found matching your criteria.</td> </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </section>
            </div>
        </main>
    </div>
</body>
</html>